<!DOCTYPE html>
<html>
<head>
    <title>Device Reservation System</title>
    <style>
        body {
            text-align: center; /* Center align the content horizontally */
        }

        h1 {
            margin-top: 20px; /* Add some top margin to the title for spacing */
        }

        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        .auth-form {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Device Reservation System</h1>

    <div id="authForm" class="auth-form">
        <form>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
            <br>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
            <br>
            <button type="button" onclick="authenticateUser()">Login</button>
        </form>
    </div>

    <div id="deviceReservation" style="display:none;">
        <button onclick="logout()">Logout</button>

        <table id="deviceTable">
            <thead>
                <tr>
                    <th>Device Name</th>
                    <th>Availability</th>
                    <th>User</th>
                    <th>Team</th>
                    <th>Time Reserved</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>New Areoflex</td>
                    <td id="availability1">Available</td>
                    <td id="user1">-</td>
                    <td id="team1">-</td>
                    <td id="time1">-</td>
                    <td>
                        <input type="text" id="userName1" placeholder="Your Name">
                        <input type="text" id="teamName1" placeholder="Team Name">
                        <button id="reserveButton1" onclick="reserveDevice(1)">Reserve</button>
                        <button id="releaseButton1" onclick="releaseDevice(1)" disabled>Release</button>
                    </td>
                </tr>
                <tr>
                    <td>TCS Areoflex</td>
                    <td id="availability2">Available</td>
                    <td id="user2">-</td>
                    <td id="team2">-</td>
                    <td id="time2">-</td>
                    <td>
                        <input type="text" id="userName2" placeholder="Your Name">
                        <input type="text" id="teamName2" placeholder="Team Name">
                        <button id="reserveButton2" onclick="reserveDevice(2)">Reserve</button>
                        <button id="releaseButton2" onclick="releaseDevice(2)" disabled>Release</button>
                    </td>
                </tr>
                <!-- Add more rows for additional devices -->
            </tbody>
        </table>
    </div>

    <script>
        const userDatabase = [
            { username: "user1", password: "pass1" },
            { username: "user2", password: "pass2" }
        ];

        // Function to retrieve reservation information from local storage
        function getReservationsFromStorage() {
            const storedReservations = localStorage.getItem("reservations");
            return storedReservations ? JSON.parse(storedReservations) : {};
        }

        // Function to save reservation information to local storage
        function saveReservationsToStorage(reservations) {
            localStorage.setItem("reservations", JSON.stringify(reservations));
        }

        // Initialize reservations from local storage
        let reservations = getReservationsFromStorage();

        function showAuthForm() {
            document.getElementById("authForm").style.display = "block";
        }

        function hideAuthForm() {
            document.getElementById("authForm").style.display = "none";
        }

        function showDeviceReservation() {
            document.getElementById("deviceReservation").style.display = "block";
        }

        function hideDeviceReservation() {
            document.getElementById("deviceReservation").style.display = "none";
        }

        function authenticateUser() {
            const enteredUsername = document.getElementById("username").value;
            const enteredPassword = document.getElementById("password").value;

            const isValidUser = userDatabase.some(user => user.username === enteredUsername && user.password === enteredPassword);

            if (isValidUser) {
                hideAuthForm();
                showDeviceReservation();
            } else {
                alert("Authentication failed. Please try again.");
            }
        }

        function logout() {
            showAuthForm();
            hideDeviceReservation();
            // You may also want to clear any user-specific data or input fields here
        }

        // Function to be called on page load
        function onPageLoad() {
            showAuthForm();
        }

        function getCurrentDateTime() {
            const now = new Date();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString();
            return `${date} ${time}`;
        }

        function reserveDevice(deviceId) {
            const availabilityCell = document.getElementById(`availability${deviceId}`);
            const userCell = document.getElementById(`user${deviceId}`);
            const teamCell = document.getElementById(`team${deviceId}`);
            const timeCell = document.getElementById(`time${deviceId}`);
            const userNameInput = document.getElementById(`userName${deviceId}`).value;
            const teamNameInput = document.getElementById(`teamName${deviceId}`).value;

            if (availabilityCell.innerHTML === 'Available' && userNameInput !== '' && teamNameInput !== '') {
                availabilityCell.innerHTML = 'Reserved';
                availabilityCell.style.color = 'red';
                userCell.innerHTML = userNameInput;
                teamCell.innerHTML = teamNameInput;
                timeCell.innerHTML = getCurrentDateTime();
                // Store reservation information
                reservations[deviceId] = { user: userNameInput, team: teamNameInput };
                saveReservationsToStorage(reservations);
                // Disable reserve button after reservation
                document.getElementById(`reserveButton${deviceId}`).disabled = true;
                // Enable release button for the user who reserved the device
                document.getElementById(`releaseButton${deviceId}`).disabled = false;
            } else if (availabilityCell.innerHTML === 'Reserved' && (userNameInput === '' || teamNameInput === '')) {
                availabilityCell.innerHTML = 'Available';
                availabilityCell.style.color = 'green';
                userCell.innerHTML = '-';
                teamCell.innerHTML = '-';
                timeCell.innerHTML = '-';
                // Clear reservation information
                delete reservations[deviceId];
                saveReservationsToStorage(reservations);
                // Enable reserve button after release
                document.getElementById(`reserveButton${deviceId}`).disabled = false;
                // Disable release button after releasing the device
                document.getElementById(`releaseButton${deviceId}`).disabled = true;
            }
        }

        function releaseDevice(deviceId) {
            const availabilityCell = document.getElementById(`availability${deviceId}`);
            const userCell = document.getElementById(`user${deviceId}`);
            const teamCell = document.getElementById(`team${deviceId}`);
            const timeCell = document.getElementById(`time${deviceId}`);
            const userNameInput = document.getElementById(`userName${deviceId}`).value;

            // Check if the current user matches the user who reserved the device
            const isAuthorizedUser = reservations[deviceId] && reservations[deviceId].user === userNameInput;

            if (availabilityCell.innerHTML === 'Reserved' && isAuthorizedUser) {
                availabilityCell.innerHTML = 'Available';
                availabilityCell.style.color = 'green';
                userCell.innerHTML = '-';
                teamCell.innerHTML = '-';
                timeCell.innerHTML = '-';
                // Clear reservation information
                delete reservations[deviceId];
                saveReservationsToStorage(reservations);
                // Enable reserve button after release
                document.getElementById(`reserveButton${deviceId}`).disabled = false;
                // Disable release button after releasing the device
                document.getElementById(`releaseButton${deviceId}`).disabled = true;
            } else {
                alert("You are not authorized to release this device.");
            }
        }

        // Call onPageLoad when the page is loaded
        onPageLoad();
    </script>
</body>
</html>
